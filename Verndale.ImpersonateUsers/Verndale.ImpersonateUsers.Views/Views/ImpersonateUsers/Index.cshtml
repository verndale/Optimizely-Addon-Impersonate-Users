@using EPiServer.Shell.Navigation
@using EPiServer.Shell.Security
@using EPiServer.Framework.Web.Mvc.Html
@model Verndale.ImpersonateUsers.Models.ImpersonateUserListViewModel

@Html.CreatePlatformNavigationMenu()
<noscript>You need to enable JavaScript to run this app.</noscript>

<div @Html.ApplyPlatformNavigation()>
    <form id="impersonateForm" method="post" action="ImpersonateUsers/Impersonate" target="_top">
        @Html.Hidden("UserName")
    </form>

    <div class="container impersonation-container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-9 col-lg-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <form method="post" id="userForm">
                            @Html.Hidden("pageIndex", Model.PageIndex)
                            @Html.Hidden("pagingSize", Model.PagingSize)
                            <div class="row mb-3">
                                <label for="FullRegion_MainRegion_FirstName" class="col-sm-3 col-form-label">Name</label>
                                <div class="col-sm-8">
                                    <input name="FirstName" type="text" maxlength="50" id="FullRegion_MainRegion_FirstName" class="form-control" value="@Model.FirstName">
                                </div>
                            </div>

                            <div class="row mb-3">
                                <label for="FullRegion_MainRegion_Email" class="col-sm-3 col-form-label">Email address</label>
                                <div class="col-sm-8">
                                    <input name="Email" type="text" maxlength="50" id="FullRegion_MainRegion_Email" class="form-control" value="@Model.Email">
                                </div>
                            </div>

                            <div class="col-auto">
                                <button type="submit" class="btn btn-primary"><i class="bi-search"></i> Search</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-sm-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th scope="col">Name</th>
                                        <th scope="col">Provider</th>
                                        <th scope="col">E-mail address</th>
                                        <th scope="col">Description</th>
                                        <th align="center" scope="col">Active</th>
                                        <th align="center" scope="col">Locked out</th>
                                        <th scope="col"></th>
                                    </tr>
                                </thead>

                                <tbody>
                                    @foreach (IUIUser user in Model.Users)
                                    {
                                        <tr>
                                            <td>@user.Username</td>
                                            <td>@user.ProviderName</td>
                                            <td>@user.Email</td>
                                            <td>@user.Comment</td>
                                            <td align="center">
                                                @if (user.IsApproved)
                                                {
                                                    <i class="bi-check-lg"></i>
                                                }
                                            </td>
                                            <td align="center">
                                                @if (user.IsLockedOut)
                                                {
                                                    <i class="bi-check-lg"></i>
                                                }
                                            </td>
                                            <td>
                                                <button class="btn btn-primary" role="button" onclick="document.getElementById('UserName').value = '@user.Username';document.getElementById('impersonateForm').submit();">
                                                    Impersonate
                                                </button>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="btn btn-outline-primary mt-2" onclick="document.getElementById('pageIndex').value++;document.getElementById('userForm').submit();">
                                Load More
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
